## Item 12: 提供有意义且易于读取的toString方法

`Object` 类提供了 `toString` 方法的实现，但它返回的字符串通常不是用户想要看到的。它由类名后跟“at”符号(@)和无符号十六进制表示的哈希码组成，例如`PhoneNumber@163b91`。`toString` 的一般约定是返回“简洁但信息丰富且易于阅读”的字符串。尽管可以说`PhoneNumber@163b91`既简洁又易于阅读，但与`707-867-5309`相比，它并不是非常信息丰富。`toString` 方法的约定进一步说明，“建议所有子类重写此方法。” 这确实是个好建议！

提供一个良好的 `toString` 实现虽然不像遵守 `equals` 和 `hashCode` 的规范（Item 10 和 Item 11）那样关键，但它可以使你的类更加愉快地使用，并且使使用该类的系统更容易调试。`toString` 方法会在对象被传递给 `println`、`printf`、字符串拼接操作符或调试器打印时自动调用。即使您从未在对象上调用 `toString`，其他人也可能会这样做。例如，一个持有对您对象的引用的组件可能会在记录的错误消息中包含对象的字符串表示。如果你没有重写 `toString`，这个信息可能几乎没有用处。

如果你为 `PhoneNumber` 提供了一个好的 `toString` 方法，生成有用的诊断信息就十分容易，如下所示：
```java
System.out.println("Failed to connect to " + phoneNumber);
```
无论是否重写 `toString`，程序员都会以这种方式生成诊断消息，但如果你没有重写，这些消息将是无用的。提供一个良好的 `toString` 方法的好处超出了类的实例，还包括包含对这些实例引用的对象，特别是集合。你更喜欢在打印一个map时看到哪种形式的输出？`{Jenny=PhoneNumber@163b91}` 还是 `{Jenny=707-867-5309}`？

在实践中，`toString` 方法应该返回对象中包含的所有有趣信息，就像上面的电话号码示例一样。如果对象很大或者它包含不适合字符串表示的状态，则可能不适合使用 `toString`。在这些情况下，`toString` 应该返回一个总结，例如 Manhattan 居民电话目录(1487536个列表) 或 Thread[main,5,main]。理想情况下，字符串应该是自解释的。（Thread的示例没有达到这个要求。）如果在字符串表示中没有包含对象的所有有趣信息，这可能导致测试失败报告的特别令人恼火，如下所示：
```
Assertion failure: expected {abc, 123}, but was {abc, 123}.
```

在实现 `toString` 方法时，你需要做一个重要的决策，即是否在文档中指定返回值的格式。对于值类，如电话号码或矩阵，建议这样做。指定格式的优点是它作为对象的标准、明确、人类可读的表示形式，可以用于输入和输出，并用于持久的人类可读的数据对象，例如 CSV 文件。如果你指定格式，通常建议提供一个匹配的静态工厂或构造函数，使程序员可以轻松地在对象和其字符串表示之间进行转换。这种方法被许多 Java 平台库中的值类采用，包括 `BigInteger`、`BigDecimal` 和大多数装箱的基本类型类。

指定 `toString` 返回值的格式的缺点是一旦指定了格式，就无法在类广泛使用时更改它。程序员将编写代码来解析表示形式、生成它，并将其嵌入到持久数据中。如果您在未来的版本中更改了表示形式，您将打破他们的代码和数据，他们会抱怨的。通过选择不指定格式，您保留了在以后的版本中添加信息或改进格式的灵活性。

无论您决定是否指定格式，都应清楚地记录您的意图。如果指定了格式，应该确切地这样做。例如，下面是与“Item 11”中的 `PhoneNumber` 类配套的 `toString` 方法的一个文档注释示例：

```java
/**
 * 返回此电话号码的字符串表示形式。
 * 字符串由12个字符组成，格式为
 * "XXX-YYY-ZZZZ"，其中 XXX 是区号、YYY 是前缀，
 * ZZZZ 是行号。每个大写字母都表示一个十进制数字。
 *
 * 如果此电话号码的任何一个部分都太小而无法填充其字段，
 * 则该字段会以前导零填充。例如，如果行号的值为 123，则
 * 字符串表示形式的最后四个字符将为 "0123"。
 */
@Override
public String toString() {
    return String.format("%03d-%03d-%04d", areaCode, prefix, lineNum);
}
```

如果您决定不指定格式，请确保文档注释读起来像这样：

```java
/**
 * 返回此药水的简要描述。表示的细节不详细，并且可能会更改，
 * 但以下内容可被视为典型：
 *
 * "[药水 #9：类型=爱情，气味=松香，外观=墨水]"
 */
@Override
public String toString() { ... }
```

在阅读了这个注释之后，如果产生了依赖于格式细节的代码或持久数据，那么当这个格式改变时，编写这些代码的程序员只能怪自己。

无论您选择是否指定格式，都应该通过提供对由 `toString` 返回的值中包含的信息的编程访问来提供。例如，`PhoneNumber` 类应该包含访问区号、前缀和行号的方法。如果你不这样做，你会迫使需要这些信息的程序员解析字符串。这不仅降低了性能，而且为程序员带来了不必要的工作，如果你改变了格式，这个过程还容易出错，导致系统变得脆弱并在更改格式时出现错误。通过不提供访问方法，你将字符串格式变成了事实上的 API，即使你已经指定它是可更改的。

在静态工具类（Item 4）中写一个 `toString` 方法是没有意义的。大多数枚举类型（Item 34）也不应该编写 `toString` 方法，因为Java已经为你提供了一个完全合适的方法。然而，在其子类共享一个公共字符串表示的抽象类中，你应该编写一个 `toString` 方法。例如，大多数集合实现的 `toString` 方法都是从抽象集合类继承的。

Google 的开源 AutoValue 库（Item 10 中讨论过）以及大多数集成开发环境（IDE）将为你生成一个 `toString` 方法。这些方法非常适合告诉你每个字段的内容，但对于类的含义来说并不特定。因此，对于像 `PhoneNumber` 这样的类使用自动生成的 `toString` 方法是不适当的（因为电话号码有一个标准的字符串表示），但对于 `Potion` 类来说是完全可以接受的。

总结一下，在你编写的每个可实例化类中覆盖 `Object` 的 `toString` 实现，除非父类已经这样做了。这样做可以使类更加愉快地使用，并有助于调试。`toString` 方法应返回一个简洁、有用的对象描述，以美观的格式呈现。
